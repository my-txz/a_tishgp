# AI 战略分析核心模块 README

## 概述
本模块是一个基于技术指标和市场结构分析的AI战略分析工具，主要用于对A股市场的股票进行量化评分，帮助投资者识别具有潜在投资价值的标的。该工具整合了多重技术指标分析、市场结构判断、机构操纵检测等功能，通过系统化的评分机制提供客观的投资参考。

## 核心类说明

### AIStrategicAnalyst 类
AI战略分析核心类，整合所有逻辑进行股票评分和分析。

#### 初始化参数
- `code`: 股票代码
- `name`: 股票名称
- `spot_data`: 股票实时数据字典，包含总市值、换手率等信息

#### 主要方法

##### fetch_history()
获取并清洗股票历史数据，为后续分析做准备。

**功能细节**：
- 自动获取最近420天的日线数据（前复权）
- 兼容不同版本akshare的列名差异，统一标准化为open/close/high/low/volume/date
- 数据校验：确保至少有60天有效数据，且包含所有必需列
- 日期格式标准化处理

**返回值**：
- 成功获取并处理数据返回True，否则返回False

##### analyze(market_env)
执行完整的股票分析流程，是核心分析方法。

**分析流程**：
1. 调用`fetch_history()`获取历史数据，失败则返回None
2. 计算所有技术指标（通过`TechnicalIndicators.calculate_all()`）
3. 市场结构与基本面分析：
   - 基于总市值判断股票市值类别
   - 清洗换手率数据
4. 机构操纵检测：通过成交量和价格行为判断是否存在机构操纵
5. 三重滤网系统筛选：
   - 第一层滤网：MACD斜率>0（趋势判断）
   - 第二层滤网：RSI<65（回调判断）
   - 第三层滤网：收盘价在5日均线之上（动能判断）
6. 深度评分（总分100+）：
   - 基础分：通过三重滤网得40分
   - 趋势强度：最高20分（完美上升趋势得20分，中期上升趋势得10分）
   - 资金流向：最高20分（结合CMF和OBV指标）
   - 机构博弈面：10分（正常订单流得10分）
   - 估值与乖离：10分（价格贴近VWAP成本线得10分）
7. 风险调整：根据市值类别进行风险系数调整
8. 计算动态止损位和止盈位：基于ATR和VWAP指标

**返回值**：
- 包含评分结果的字典，或None（未通过筛选）

##### _construct_result()
构建标准化的返回结果字典，包含评分、原因、数据等信息。

## 辅助功能说明

### 数值清洗工具（SystemUtils.clean_numeric）
静态方法，用于清洗字符串格式的数值数据：
- 处理包含"亿"、"万"、"%"等单位的字符串
- 示例：'10.5亿' → 10.5，'20%' → 20.0
- 支持整数、浮点数和字符串类型的输入

### Fisher Transform 指标
将价格数据转换为接近正态分布，使转折点更清晰：
- 将值映射到-1.5到1.5之间
- 通过对数转换增强价格转折点的识别度
- 简化版实现：`0.5 * np.log((1 + val) / (1 - val + 1e-6))`

## 评分结果说明
分析结果包含以下关键信息：
- `score`: 最终评分（保留一位小数）
- `reason`: 评分理由（各项得分的汇总说明）
- `df`: 处理后的历史数据DataFrame
- `curr`: 最新一期的指标数据
- `cap_type`: 市值类别
- `turnover`: 换手率
- `manipulation`: 机构操纵检测结果
- `stop_loss`: 动态止损位
- `take_profit`: 目标止盈位

## 依赖说明
- 需要akshare库获取股票历史数据
- 需要pandas处理数据
- 需要numpy进行数值计算
- 需要datetime处理日期相关操作

## 使用注意事项
1. 历史数据获取可能因网络或接口问题失败，需做好异常处理
2. 分析结果仅作为投资参考，不构成投资建议
3. 对于流动性过低的股票会直接忽略（标记为"Ignore"）
4. 存在机构操纵风险（标记为"Danger"）的股票会直接给出0分

通过以上功能，本模块能够为投资者提供系统化、多维度的股票分析，帮助在复杂的市场环境中筛选出具有潜在机会的投资标的。
